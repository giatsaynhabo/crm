<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸ“¦ Danh sÃ¡ch Ä‘Æ¡n hÃ ng</title>

  <!-- â›” áº¨n trang cho Ä‘áº¿n khi kiá»ƒm tra quyá»n xong -->
  <style>
    html, body {
      visibility: hidden;
      background: #f4f6f8;
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 0;
    }
  </style>

  <!-- âœ… Kiá»ƒm tra quyá»n trÆ°á»›c khi hiá»ƒn thá»‹ -->
  <script type="module">
    import { initProtectedPage } from "./js/permissionInit.js";
    await initProtectedPage("donhangManage", "view"); // chá»‰ ngÆ°á»i cÃ³ quyá»n donhangManage.view má»›i xem Ä‘Æ°á»£c
  </script>

  <!-- CSS -->
  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="css/donhang_ds.css" />

  <!-- Firebase + Script -->
  <script type="module" src="js/firebaseConfig.js"></script>
  <script type="module" src="js/menu.js" defer></script>
  <script type="module" src="js/donhang_ds.js" defer></script>
  <!-- Tom Select (dropdown tÃ¬m kiáº¿m Ä‘a chá»n) -->
<link
href="https://cdn.jsdelivr.net/npm/tom-select@2.3.1/dist/css/tom-select.css"
rel="stylesheet"
/>
<script src="https://cdn.jsdelivr.net/npm/tom-select@2.3.1/dist/js/tom-select.complete.min.js"></script>

</head>

<body>
  <!-- Menu tá»± Ä‘á»™ng load vÃ  Ã¡p dá»¥ng quyá»n -->
  <div id="menu"></div>

  <main class="container">
    <h1>ğŸ“¦ Danh sÃ¡ch Ä‘Æ¡n hÃ ng</h1>

    <!-- Thanh cÃ´ng cá»¥ -->
    <section class="toolbar-card">
      <div class="left">
        <select id="filterStatus">
          <option value="">Táº¥t cáº£ tráº¡ng thÃ¡i</option>
          <option value="Ä‘Ã£ giáº·t xong">ÄÃ£ giáº·t xong</option>
          <option value="chá» giao">Chá» giao</option>
          <option value="Ä‘Ã£ giao">ÄÃ£ giao</option>
          <option value="há»§y">Há»§y</option>
        </select>
    
        <input id="searchInput" placeholder="TÃ¬m theo OrderID hoáº·c SÄT..." />
        <div class="creator-filter">
          <select id="filterCreator" placeholder="Chá»n ngÆ°á»i táº¡o..." multiple></select>
        </div>
        
        <input id="filterDateFrom" type="date" />
        <input id="filterDateTo" type="date" />
    
        <button id="btnSearch" class="btn search">ğŸ” TÃ¬m</button>
        <button id="btnClear" class="btn delete">ğŸ—‘ï¸ XÃ³a</button>
      </div>
    
      <div class="right">
        <button id="btnSync" class="btn"
          data-permission-key="donhangManage"
          data-permission-action="sync">
          ğŸ” Äá»“ng bá»™
        </button>
    
        <button id="btnExportExcel" class="btn excel"
          data-permission-key="donhangManage"
          data-permission-action="export">
          ğŸ“Š Xuáº¥t Excel
        </button>
    
        <button id="btnReload" class="btn primary"
          data-permission-key="donhangManage"
          data-permission-action="reload">
          ğŸ”„ Táº£i láº¡i
        </button>
      </div>
    </section>
    
    <!-- Báº£ng dá»¯ liá»‡u -->
    <section class="card">
      <table class="data-table" id="ordersTable">
        <thead>
          <tr>
            <th>OrderID</th>
            <th>KhÃ¡ch</th>
            <th>SÄT</th>
            <th>Sáº£n pháº©m (tá»•ng loáº¡i)</th>
            <th>Tá»•ng tiá»n</th>
            <th>Giáº£m giÃ¡</th>
            <th>Thanh toÃ¡n</th>
            <th>CÃ²n ná»£</th>
            <th>Tráº¡ng thÃ¡i</th>
            <th>NgÃ y táº¡o</th>
            <th>NgÃ y giao</th>
            <th>HÃ nh Ä‘á»™ng</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>
  </main>

  <!-- Modal chi tiáº¿t Ä‘Æ¡n -->
  <div id="modalDetail" class="modal">
    <div class="modal-content">
      <h2>Chi tiáº¿t Ä‘Æ¡n <span id="detailOrderId"></span></h2>
      <div id="detailBody"></div>

      <div class="modal-actions">
        <button id="btnMarkDelivered" class="btn primary"
          data-permission-key="donhangManage"
          data-permission-action="update">
          âœ… ÄÃ¡nh dáº¥u Ä‘Ã£ giao
        </button>

        <button id="btnPrintInvoice" class="btn"
          data-permission-key="donhangManage"
          data-permission-action="print">
          ğŸ–¨ï¸ In hÃ³a Ä‘Æ¡n
        </button>

        <button id="btnCloseDetail" class="btn">âŒ ÄÃ³ng</button>
      </div>
    </div>
  </div>

  <!-- âœ… Sau khi load toÃ n bá»™ trang, Ã¡p dá»¥ng UI permission -->
  <script type="module">
    import { applyPermissionUI } from "./js/checkPermission.js";
    await applyPermissionUI();
    // Khi hoÃ n táº¥t, hiá»ƒn thá»‹ láº¡i trang
    document.documentElement.style.visibility = "visible";
    document.body.style.visibility = "visible";
  </script>
</body>
</html>
